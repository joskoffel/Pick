<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quantum Streaming Recommendation</title>
  <!-- Tailwind CSS via CDN for styling -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- A few custom styles to refine the appearance -->
  <style>
    /* Smooth transition for button hover state */
    #generateBtn {
      transition: background-color 0.2s ease;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <main class="max-w-lg w-full p-8 bg-white rounded-xl shadow-lg text-center">
    <h1 class="text-2xl font-bold mb-6">Quantum Random Picker</h1>
    <!-- Platform selection checkboxes -->
    <div class="flex justify-center space-x-8 mb-8">
      <label class="flex items-center space-x-2">
        <input type="checkbox" id="netflix" class="h-5 w-5 text-red-600 border-gray-300 rounded">
        <span class="text-gray-700 font-medium">Netflix</span>
      </label>
      <label class="flex items-center space-x-2">
        <input type="checkbox" id="max" class="h-5 w-5 text-blue-600 border-gray-300 rounded">
        <span class="text-gray-700 font-medium">MAX</span>
      </label>
      <label class="flex items-center space-x-2">
        <input type="checkbox" id="disney" class="h-5 w-5 text-indigo-600 border-gray-300 rounded">
        <span class="text-gray-700 font-medium">Disney+</span>
      </label>
    </div>
    <!-- Generate button -->
    <button id="generateBtn" class="px-8 py-4 bg-blue-600 text-white font-semibold rounded-full hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300">Generovať</button>
    <!-- Message area for warnings or errors -->
    <div id="message" class="mt-6 text-red-600 hidden"></div>
    <!-- Loading indicator -->
    <div id="loading" class="mt-6 text-gray-500 hidden">Fetching quantum randomness...</div>
    <!-- Result area to display the selected title and description -->
    <div id="result" class="mt-6 text-left"></div>
  </main>
 <!-- označím tu len JS časť, HTML zvyšok zostal nezmenený -->
<script>
  const TMDB_API_KEY = 'YOUR_TMDB_API_KEY_HERE';

  const PROVIDERS = {
    netflix: 8,
    max: 384,
    disney: 337
  };

  const titles = {
    netflix: [],
    max: [],
    disney: []
  };

  async function fetchTopTitles(platform) {
    const providerId = PROVIDERS[platform];
    const url = `https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_API_KEY}&language=en-US&sort_by=vote_average.desc&vote_count.gte=500&with_watch_providers=${providerId}&watch_region=US&page=1`;

    const response = await fetch(url);
    const data = await response.json();

    // Prepíšme na formát tvojej appky
    titles[platform] = data.results.slice(0, 20).map(movie => ({
      title: movie.title,
      description: movie.overview || "No description available."
    }));
  }

  async function preloadAllPlatforms() {
    await Promise.all([
      fetchTopTitles('netflix'),
      fetchTopTitles('max'),
      fetchTopTitles('disney')
    ]);
  }

  // Quantum buffer as before
  const randomBuffer = [];
  let lastFetchTime = 0;
  let fetching = false;

  async function refillRandomBuffer(batchSize = 128) {
    if (fetching) return;
    const now = Date.now();
    if (now - lastFetchTime < 60000) {
      throw new Error('Quantum randomness rate limit exceeded – please wait a minute and try again.');
    }
    fetching = true;
    const apiUrl = `https://qrng.anu.edu.au/API/jsonI.php?length=${batchSize}&type=uint8`;
    const response = await fetch(apiUrl, { mode: 'cors', cache: 'no-store' });
    if (!response.ok) {
      fetching = false;
      throw new Error('Network response was not ok');
    }
    const data = await response.json();
    if (!data.success || !data.data || data.data.length === 0) {
      fetching = false;
      throw new Error('Invalid response from quantum API');
    }
    randomBuffer.push(...data.data);
    lastFetchTime = Date.now();
    fetching = false;
  }

  async function getQuantumRandomNumber(max) {
    if (randomBuffer.length === 0) {
      await refillRandomBuffer();
    }
    if (randomBuffer.length === 0) {
      throw new Error('No quantum random numbers available. Please wait and try again.');
    }
    const raw = randomBuffer.shift();
    return raw % max;
  }

  document.addEventListener('DOMContentLoaded', async () => {
    try {
      await preloadAllPlatforms();
    } catch (e) {
      console.error("TMDb loading failed:", e);
      alert("Nepodarilo sa načítať zoznam filmov z TMDb. Skontroluj API kľúč.");
    }
  });

  document.getElementById('generateBtn').addEventListener('click', async () => {
    const messageEl = document.getElementById('message');
    const loadingEl = document.getElementById('loading');
    const resultEl = document.getElementById('result');

    messageEl.classList.add('hidden');
    loadingEl.classList.add('hidden');
    resultEl.innerHTML = '';

    const selectedPlatforms = [];
    if (document.getElementById('netflix').checked) selectedPlatforms.push('netflix');
    if (document.getElementById('max').checked) selectedPlatforms.push('max');
    if (document.getElementById('disney').checked) selectedPlatforms.push('disney');

    if (selectedPlatforms.length === 0) {
      messageEl.textContent = 'Please select at least one platform.';
      messageEl.classList.remove('hidden');
      return;
    }

    const combined = [];
    selectedPlatforms.forEach(platform => {
      combined.push(...titles[platform]);
    });

    if (combined.length === 0) {
      messageEl.textContent = 'No titles loaded. Please wait or check your API key.';
      messageEl.classList.remove('hidden');
      return;
    }

    loadingEl.classList.remove('hidden');
    try {
      const index = await getQuantumRandomNumber(combined.length);
      const chosen = combined[index];
      resultEl.innerHTML =
        '<h2 class="text-xl font-semibold mb-2">' + chosen.title + '</h2>' +
        '<p class="text-gray-700">' + chosen.description + '</p>';
    } catch (error) {
      messageEl.textContent = 'Error fetching quantum randomness: ' + error.message;
      messageEl.classList.remove('hidden');
    } finally {
      loadingEl.classList.add('hidden');
    }
  });
</script>
</body>
</html>
